from aiogram import Dispatcher
from aiogram.types import Message

from app.keyboards import Buttons
from app.keyboards.reply.context import today_kb, group_kb
from app.keyboards.reply.menu import back_menu_kb
from database.services.repos import GroupRepo, UserRepo


async def notify_and_links(msg: Message):
    text = (
        '<b>‚Ñπ –Ø–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –±–æ—Ç–∞ –º–∞–∫—Å–∏–º—É–º –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ?</b>\n\n'
        'üî∏ <b>–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è</b>\n\n'
        '–©–æ–± –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –Ω–∞ –±—É–¥—å-—è–∫—É –ø–∞—Ä—É –∑–∞ 5 —Ö–≤ –¥–æ —ó—ó –ø–æ—á–∞—Ç–∫—É, –ø–µ—Ä–µ–π–¥–∏ –≤ —Ä–æ–∑–¥—ñ–ª '
        '<b>"–¶–µ–π —Ç–∏–∂–¥–µ–Ω—å/–ù–∞—Å—Ç—É–ø–Ω–∏–π"</b>, –∑–Ω–∞–π–¥–∏ –ø–∞—Ä—É, —è–∫–∞ —Ç–µ–±–µ —Ü—ñ–∫–∞–≤–∏—Ç—å, –Ω–∞—Ç–∏—Å–Ω–∏ –∫–Ω–æ–ø–∫—É '
        '<b>"üîî –°–ø–æ–≤—ñ—â–µ–Ω–Ω—è"</b>, —Ç–∞ –æ–±–µ—Ä–∏ –æ–ø—Ü—ñ—é —É–≤—ñ–º–∫–Ω—É—Ç–∏ –∞–±–æ –≤–∏–º–∫–Ω—É—Ç–∏. –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –≤—Å—ñ '
        '—Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è —É–≤—ñ–º–∫–Ω–µ–Ω—ñ. –î–ª—è —Ç–æ–≥–æ —â–æ–± —É–≤—ñ–º–∫–Ω—É—Ç–∏/–≤–∏–º–∫–Ω—É—Ç–∏ –≤—Å—ñ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –æ–¥—Ä–∞–∑—É, –ø–µ—Ä–µ–π–¥–∏ –≤ —Ä–æ–∑–¥—ñ–ª '
        f'<b>"{Buttons.menu.settings}"</b> —Ç–∞ –æ–±–µ—Ä–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—É –æ–ø—Ü—ñ—é.\n\n'
        f'üî∏ <b>–ü–æ—Å–∏–ª–∞–Ω–Ω—è</b>\n\n'
        f'–Ø–∫—â–æ —Ö–æ—á–µ—à –∑–±–µ—Ä–µ–≥—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–∞—Ä—É –≤ –±–æ—Ç—ñ, –ø–µ—Ä–µ–π–¥–∏ –≤ —Ä–æ–∑–¥—ñ–ª <b>"–¶–µ–π —Ç–∏–∂–¥–µ–Ω—å/–ù–∞—Å—Ç—É–ø–Ω–∏–π"</b> '
        f'–∑–Ω–∞–π–¥–∏ –ø–∞—Ä—É, —è–∫–∞ —Ç–µ–±–µ —Ü—ñ–∫–∞–≤–∏—Ç—å, –Ω–∞—Ç–∏—Å–Ω–∏ –∫–Ω–æ–ø–∫—É <b> "üîó –ü–æ—Å–∏–ª–∞–Ω–Ω—è"</b>, —ñ –Ω–∞–¥—ñ—à–ª–∏ –ª—ñ–Ω–∫, –∑ –æ–¥–Ω—ñ—î—ó '
        f'–∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º Zoom –±–æ GoogleMeet. –í–∏–¥–∞–ª–∏—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –º–æ–∂–Ω–∞ –≤ —Ç–æ–º—É –∂ —Ä–æ–∑–¥—ñ–ª—ñ.\n\n'
        f'üí≠ –ù–µ–∑–∞–±—É–≤–∞–π –¥—ñ–ª–∏—Ç–∏—Å—å @kpi_rozklad_bot –∑ –¥—Ä—É–∑—è–º–∏. –£—Å–ø—ñ—Ö—ñ–≤!'
    )
    await msg.answer(text, reply_markup=today_kb)


async def groups_and_chats(msg: Message, user_db: UserRepo, group_db: GroupRepo):
    user = await user_db.get_user(msg.from_user.id)
    group = await group_db.get_group(user.group_id)
    text = (
        '<b>‚Ñπ –Ø–∫ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –≤ –≥—Ä—É–ø–æ–≤–æ–º—É —á–∞—Ç—ñ?</b>\n\n'
        'üî∏ <b>–ì—Ä—É–ø–æ–≤–∏–π —á–∞—Ç</b>\n\n'
        '–©–æ–± –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –≤ —Ç–µ–ª–µ–≥—Ä–∞–º –≥—Ä—É–ø—ñ —Ç—Ä–µ–±–∞ –≤–∏–∫–æ–Ω–∞—Ç–∏ –¥–µ–∫—ñ–ª—å–∫–∞ –ø—Ä–æ—Å—Ç–∏—Ö —É–º–æ–≤:\n\n'
        '- –î–æ–¥–∞—Ç–∏ –±–æ—Ç–∞ –≤ —á–∞—Ç –≥—Ä—É–ø–∏\n'
        '- –ù–∞–¥–∞—Ç–∏ –±–æ—Ç—É –ø—Ä–∞–≤–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞\n'
        '- –î–æ–¥–∞—Ç–∏ —á–∞—Ç –≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö <b>"–ú–æ—è –≥—Ä—É–ø–∞üéì"</b>\n\n'
        'üïê –ü—ñ—Å–ª—è —Ü—å–æ–≥–æ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –±—É–¥—É—Ç—å –ø—Ä–∏—Ö–æ–¥–∏—Ç–∏ –≤ —á–∞—Ç –∑–∞ 5 —Ö–≤ –¥–æ –ø–æ—á–∞—Ç–∫—É –ø–∞—Ä–∏.\n\n'
        '–í–∏–¥–∞–ª–∏—Ç–∏ —á–∞—Ç –º–æ–∂–Ω–∞ –≤ —Ç–æ–º—É –∂ —Ä–æ–∑–¥—ñ–ª—ñ. –Ø–∫—â–æ –±–æ—Ç –Ω–µ –∑–º–æ–∂–µ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ —á–∞—Ç,'
        '—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –≥—Ä—É–ø–æ–≤–∏–π —á–∞—Ç –±—É–¥–µ –≤–∏–¥–∞–ª–µ–Ω–∞ –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö.\n\n'
        'üí≠ –ù–µ–∑–∞–±—É–≤–∞–π –¥—ñ–ª–∏—Ç–∏—Å—å @kpi_rozklad_bot –∑ –¥—Ä—É–∑—è–º–∏. –£—Å–ø—ñ—Ö—ñ–≤!'
    )
    await msg.answer(text, reply_markup=group_kb(group.chat_id is not None))


async def info_user_cmd(msg: Message):
    await msg.answer(read_message(), reply_markup=back_menu_kb, disable_web_page_preview=True)


def setup(dp: Dispatcher):
    dp.register_message_handler(notify_and_links, text=Buttons.today.info, state='*')
    dp.register_message_handler(groups_and_chats, text=Buttons.group.info, state='*')
    dp.register_message_handler(info_user_cmd, text=Buttons.menu.news, state='*')


def read_message():
    with open('app/handlers/admin/message.txt', 'r', encoding='utf-8') as file:
        return file.read()